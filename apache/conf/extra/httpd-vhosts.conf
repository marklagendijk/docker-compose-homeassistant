<VirtualHost *:443>
    ServerName ${HOME_ASSISTANT_SUBDOMAIN}.${ROOT_DOMAIN}
    ProxyRequests Off

    SSLEngine on
    SSLCertificateFile /letsencrypt/live/${ROOT_DOMAIN}/cert.pem
    SSLCertificateChainFile /letsencrypt/live/${ROOT_DOMAIN}/fullchain.pem
    SSLCertificateKeyFile /letsencrypt/live/${ROOT_DOMAIN}/privkey.pem

    RewriteEngine on
    RewriteCond %{HTTP:CONNECTION} Upgrade$ [NC]
    RewriteCond %{HTTP:UPGRADE} websocket [NC]
    RewriteRule (.*) ws://homeassistant:8123$1 [P,END]
    RewriteRule (.*) http://homeassistant:8123$1 [P,END]
</VirtualHost>